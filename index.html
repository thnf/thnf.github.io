<!DOCTYPE html>
<html id="html" lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä¿¡æ¯å­¦ç½‘ç«™æ€»ç½‘ å¯¼èˆª</title>

<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family: "PingFang SC","Microsoft YaHei",sans-serif; }
  body, html { width:100%; height:100%; background:#f5f5f5; }

  .sidebar {
    position: fixed; left:-250px; top:0; width:250px; height:100%;
    background:#ffffff; border-right:1px solid #ddd; transition:0.3s; overflow-y:auto; z-index:10;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  }
  .sidebar.open { left:0; }
  .sidebar .top { font-size:18px; padding:16px; text-align:center; background:#f1f3f4; font-weight:bold; }
  .sidebar ul { list-style:none; }
  .sidebar ul li { border-bottom:1px solid #eee; }
  .sidebar ul li button {
    width:100%; padding:12px; border:none; background:none; text-align:left; font-size:16px;
    cursor:pointer; transition:0.2s;
  }
  .sidebar ul li button:hover { background:#f1f3f4; }

  .content { margin-left:0; transition:0.3s; height:100vh; overflow:hidden; }
  .content.open { margin-left:250px; }

  #toggleSidebar {
    position:fixed; top:10px; left:10px; z-index:20;
    padding:8px 12px; background:#4285f4; color:#fff; border:none; border-radius:4px; cursor:pointer;
  }
  #toggleSidebar:hover { background:#357ae8; }

  #moshi {
    border-radius: 14px; padding: 8px 16px; height:40px;
    border:none; background-color:#00ffff; color:#333;
    font-weight:bold; font-size:14px; cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,0.2); transition:0.3s; margin:8px;
  }
  #moshi:hover { background-color:#00dddd; }

  #titleText {
    font-size:16px; padding:10px; text-align:center; background:#f1f3f4;
  }

  #main { width:100%; height:100%; border:none; }
</style>
</head>

<body>
<button id="toggleSidebar">â˜°</button>

<div class="sidebar" id="sidebar">
  <div class="top">ä¿¡æ¯å­¦æ€»ç½‘å¯¼èˆª</div>
  <div id="titleText">æ¬¢è¿è®¿é—®ä¿¡æ¯å­¦ç½‘ç«™æ€»ç½‘</div>
  <button id="moshi" name="baitian" onclick="moshi()">åˆ‡æ¢å¤œé—´</button>

  <ul>
    <li><button onclick="openPage('bpuxi')">ğŸ  ä¸»é¡µ</button></li>
    <li><button onclick="openPage('jiaoyu')">ğŸ“ æ•™è‚²ç‰ˆ</button></li>
    <li><button onclick="openPage('yule')">ğŸ­ å¨±ä¹ç‰ˆ</button></li>
    <li><button onclick="openPage('tv')">ğŸ“º TVç‰ˆ</button></li>
    <li><button onclick="openPage('betaweb')">âš¡ æŠ¢å…ˆç‰ˆ</button></li>
    <li><button onclick="openPage('tools')">ğŸ§° å·¥å…·ç®±</button></li>
  </ul>
</div>

<div class="content" id="content">
  <iframe id="main" src=""></iframe>
</div>

<script>
  const sidebar = document.getElementById('sidebar');
  const content = document.getElementById('content');
  const toggleBtn = document.getElementById('toggleSidebar');
  const html = document.getElementById('html');
  const mainIframe = document.getElementById('main');

  // ä¾§æ å¼€å…³
  toggleBtn.onclick = () => { 
    sidebar.classList.toggle('open'); 
    content.classList.toggle('open'); 
  };

  /* ===========================
        å¤œé—´æ¨¡å¼åˆ‡æ¢
     =========================== */
  function moshi() {
    const btn = document.getElementById("moshi");

    if (btn.name === "baitian") {
      btn.name = "yejian";
      btn.innerText = "åˆ‡æ¢æ—¥é—´";
      html.style.filter = "invert(80%) hue-rotate(180deg)";
      btn.style.backgroundColor = "#333";
      btn.style.color = "#00ffff";
    } else {
      btn.name = "baitian";
      btn.innerText = "åˆ‡æ¢å¤œé—´";
      html.style.filter = "none";
      btn.style.backgroundColor = "#00ffff";
      btn.style.color = "#333";
    }
  }

  /* ===========================
        é¡µé¢ç™½åå•ç³»ç»Ÿ
     =========================== */

  const ALLOWED_PAGES = [
    "./page/bpuxi.html",
    "./page/jiaoyu.html",
    "./page/yule.html",
    "./page/tv.html",
    "./page/betaweb.html",
    "./page/tools.html"
  ];

  const STORAGE_KEY = "last_visited_iframe_page";

  // æ‰“å¼€é¡µé¢å¹¶ä¿å­˜è®°å½•
  function openPage(name) {
    const full = `./page/${name}.html`;
    if (!ALLOWED_PAGES.includes(full)) return;
    mainIframe.src = full;
    saveVisit(full);
  }

  // ä¿å­˜è®°å½•ï¼ˆlocalStorage + cookieï¼‰
  function saveVisit(page) {
    localStorage.setItem(STORAGE_KEY, page);
    document.cookie = `${STORAGE_KEY}=${page}; max-age=2592000; path=/;`;
  }

  // è¯»å–è®°å½•
  function loadRecord() {
    const ls = localStorage.getItem(STORAGE_KEY);
    if (ls && ALLOWED_PAGES.includes(ls)) return ls;

    const cookie = document.cookie
      .split(";")
      .map(x => x.trim())
      .find(x => x.startsWith(STORAGE_KEY + "="));

    if (cookie) {
      const val = cookie.split("=")[1];
      if (ALLOWED_PAGES.includes(val)) return val;
    }

    return "./page/bpuxi.html";
  }

  /* ===========================
        é¡¶éƒ¨åŠ¨æ€é—®å€™
     =========================== */
  function hellowl() {
    const title = document.getElementById('titleText');
    const h = new Date().getHours();

    if (h >= 23 || h < 3) title.innerText = 'é˜ä¸‹ï¼Œåˆå¤œäº†ï¼Œè¿˜ä¸ä¼‘æ¯å—ï¼Ÿ';
    else if (h >= 22) title.innerText = 'é˜ä¸‹ï¼Œæ˜¯æ—¶å€™ç¡è§‰äº†å‘¢ï¼';
    else if (h >= 18) title.innerText = 'é˜ä¸‹ï¼Œæ™šä¸Šå¥½ï¼';
    else if (h >= 13) title.innerText = 'é˜ä¸‹ï¼Œä¸‹åˆå¥½ï¼';
    else if (h >= 12) title.innerText = 'é˜ä¸‹ï¼Œåˆå¥½ï¼Œåˆé¥­é£Ÿç”¨äº†å—ï¼Ÿ';
    else if (h >= 8) title.innerText = 'é˜ä¸‹ï¼Œä¸Šåˆå¥½ï¼';
    else title.innerText = 'é˜ä¸‹ï¼Œæ—©ä¸Šå¥½ï¼';
  }

  /* ===========================
        é¡µé¢å…³é—­å‰ä¿å­˜è®°å½•
     =========================== */
  window.onbeforeunload = () => {
    const current = mainIframe.src.replace(location.origin, ".");
    saveVisit(current);
  };

  /* ===========================
        åˆå§‹åŒ–
     =========================== */
  window.onload = () => {
    hellowl();
    setInterval(hellowl, 60000);

    const lastPage = loadRecord();
    mainIframe.src = lastPage;
  };
</script>


</body>
</html>
