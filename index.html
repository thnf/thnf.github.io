<!DOCTYPE html>
<html id="html" lang="zh-CN">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä¿¡æ¯å­¦ç½‘ç«™æ€»ç½‘ å¯¼èˆª</title>
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "pmp8on0d5k");
  </script>

    <script type="text/javascript">
           var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?599433e2313d5b601a736a6dea2770f3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
    </script>

      <script type="text/javascript">
           !function(p){"use strict";!function(t){var s=window,e=document,i=p,c="".concat("https:"===e.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),n=e.createElement("script"),r=e.getElementsByTagName("script")[0];n.type="text/javascript",n.setAttribute("charset","UTF-8"),n.async=!0,n.src=c,n.id="LA_COLLECT",i.d=n;var o=function(){s.LA.ids.push(i)};s.LA?s.LA.ids&&o():(s.LA=p,s.LA.ids=[],o()),r.parentNode.insertBefore(n,r)}()}({id:"JuwJmSVQNTdeACxY",ck:"JuwJmSVQNTdeACxY"});
    </script>

      <script defer src="https://clarify.bpuxi.top/script.js" data-website-id="62c6aa81-f4ed-4ba7-bdfb-4d4c2eba865e"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family: "PingFang SC","Microsoft YaHei",sans-serif; }
  body, html { width:100%; height:100%; background:#f5f5f5; }

  /* ================== Google é£æ ¼ä¾§è¾¹æ  ================== */
  .sidebar {
    position: fixed;
    left:-250px;
    top:0;
    width:250px;
    height:100%;
    background:#ffffff;
    border-right:1px solid #ddd;
    transition:0.3s;
    overflow-y:auto;
    z-index:10;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  }
  .sidebar.open { left:0; }
  .sidebar .top { font-size:18px; padding:16px; text-align:center; background:#f1f3f4; font-weight:bold; }
  .sidebar ul { list-style:none; }
  .sidebar ul li { border-bottom:1px solid #eee; }
  .sidebar ul li button {
    width:100%; padding:12px; border:none; background:none; text-align:left; font-size:16px;
    cursor:pointer; transition:0.2s;
  }
  .sidebar ul li button:hover { background:#f1f3f4; }

  /* ================== å†…å®¹åŒº ================== */
  .content {
    margin-left:0;
    transition:0.3s;
    height:100vh;
    overflow:hidden;
  }
  .content.open { margin-left:250px; }

  /* ================== é¡¶éƒ¨æŒ‰é’® ================== */
  #toggleSidebar {
    position:fixed; top:10px; left:10px; z-index:20;
    padding:8px 12px; background:#4285f4; color:#fff; border:none; border-radius:4px; cursor:pointer;
  }
  #toggleSidebar:hover { background:#357ae8; }

  /* ================== å¤œé—´åˆ‡æ¢æŒ‰é’® ================== */
  #moshi {
    border-radius: 14px; padding: 8px 16px; height:40px;
    border:none; background-color:#00ffff; color:#333;
    font-weight:bold; font-size:14px; cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,0.2); transition:0.3s; margin:8px;
  }
  #moshi:hover { background-color:#00dddd; }

  /* ================== é¡¶éƒ¨é—®å€™æ–‡å­— ================== */
  #titleText {
    font-size:16px; padding:10px; text-align:center; background:#f1f3f4;
  }

  /* ================== iframe æ ·å¼ ================== */
  #main {
    width:100%; height:100%;
    border:none;
  }

  /* ================== æ‰‹æœºç«¯é€‚é… ================== */
  @media(max-width:768px) {
    .sidebar { width:200px; }
    .content.open { margin-left:200px; }
  }
</style>
</head>

<body>
<button id="toggleSidebar">â˜°</button>
<div class="sidebar" id="sidebar">
  <div class="top">ä¿¡æ¯å­¦æ€»ç½‘å¯¼èˆª</div>
  <div id="titleText">æ¬¢è¿è®¿é—®ä¿¡æ¯å­¦ç½‘ç«™æ€»ç½‘</div>
  <button id="moshi" name="baitian" onclick="moshi()">åˆ‡æ¢å¤œé—´</button>
  <ul>
    <li><button onclick="openPage('bpuxi')">ğŸ  ä¸»é¡µ</button></li>
    <li><button onclick="openPage('jiaoyu')">ğŸ“ æ•™è‚²ç‰ˆ</button></li>
    <li><button onclick="openPage('yule')">ğŸ­ å¨±ä¹ç‰ˆ</button></li>
    <li><button onclick="openPage('tv')">ğŸ“º TVç‰ˆ</button></li>
    <li><button onclick="openPage('betaweb')">âš¡ æŠ¢å…ˆç‰ˆ</button></li>
    <li><button onclick="openPage('tools')">ğŸ§° å·¥å…·ç®±</button></li>
  </ul>
</div>

<div class="content" id="content">
  <iframe id="main" src=""></iframe>
</div>

<script>
  const sidebar = document.getElementById('sidebar');
  const content = document.getElementById('content');
  const toggleBtn = document.getElementById('toggleSidebar');
  const html = document.getElementById('html');
  const mainIframe = document.getElementById('main');
  
  // æ ¸å¿ƒé…ç½®
  const STORAGE_KEY = 'last_visited_iframe_page';
  const ALLOWED_PREFIX = './page/';
  const ALLOWED_PAGES = [
    './page/bpuxi.html',
    './page/jiaoyu.html',
    './page/yule.html',
    './page/tv.html',
    './page/betaweb.html',
    './page/tools.html'
  ];
  
  // å®æ—¶ç¼“å­˜å½“å‰æœ‰æ•ˆçš„é¡µé¢è·¯å¾„ï¼ˆå…³é”®ï¼šé¿å…å…³é—­æ—¶å†å¤„ç†è·¯å¾„ï¼‰
  let currentValidPage = './page/bpuxi.html'; // é»˜è®¤ä¸»é¡µ

  // ================== ä¾§è¾¹æ å¼€å…³ ==================
  toggleBtn.onclick = ()=>{ 
    sidebar.classList.toggle('open'); 
    content.classList.toggle('open'); 
  }

  // ================== å¤œé—´æ¨¡å¼åˆ‡æ¢ ==================
  function moshi() {
    const btn = document.getElementById("moshi");
    if(btn.name === "baitian") {
      btn.name = "yejian"; 
      btn.innerText = "åˆ‡æ¢æ—¥é—´";
      html.style.filter = "grayscale(100%) invert(74%) hue-rotate(74deg) brightness(84%) saturate(400%) contrast(200%) sepia(24%)";
      btn.style.backgroundColor = "#333"; 
      btn.style.color = "#00ffff";
    } else {
      btn.name = "baitian"; 
      btn.innerText = "åˆ‡æ¢å¤œé—´";
      html.style.filter = "none";
      btn.style.backgroundColor = "#00ffff"; 
      btn.style.color = "#333";
    }
  }

  // ================== è·¯å¾„å¤„ç†ï¼ˆè¡¥å…¨+éªŒè¯ï¼‰ ==================
  function processPath(path) {
    if (!path) return null;
    let cleanedPath = path.trim();

    // ç¦æ­¢éæ³•è·¯å¾„
    if (cleanedPath.includes('../') || cleanedPath.includes('..\\') || 
        cleanedPath.startsWith('http://') || cleanedPath.startsWith('https://') || cleanedPath.startsWith('//')) {
      console.warn('éæ³•è·¯å¾„æ‹¦æˆª:', cleanedPath);
      return null;
    }

    // è¡¥å…¨å‰ç¼€å’Œåç¼€
    if (!cleanedPath.startsWith(ALLOWED_PREFIX)) {
      cleanedPath = ALLOWED_PREFIX + cleanedPath;
    }
    if (!cleanedPath.endsWith('.html')) {
      cleanedPath += '.html';
    }

    // ç™½åå•æ ¡éªŒ
    if (!ALLOWED_PAGES.includes(cleanedPath)) {
      console.warn('é¡µé¢ä¸åœ¨ç™½åå•:', cleanedPath);
      return null;
    }

    return cleanedPath;
  }

  // ================== åŒæ­¥å­˜å‚¨è®¿é—®è®°å½•ï¼ˆå…³é”®ï¼šåŒæ­¥æ‰§è¡Œï¼Œæ— å»¶è¿Ÿï¼‰ ==================
  function saveVisitRecord(page) {
    if (!page || !ALLOWED_PAGES.includes(page)) return;
    try {
      // 1. localStorageï¼ˆåŒæ­¥æ“ä½œï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼‰
      localStorage.setItem(STORAGE_KEY, page);
      // 2. Cookieï¼ˆåŒæ­¥æ“ä½œï¼Œå¤‡ç”¨ï¼‰
      document.cookie = `${STORAGE_KEY}=${encodeURIComponent(page)}; max-age=${30*24*60*60}; path=/; SameSite=Lax`;
      console.log('è®°å½•å·²ä¿å­˜:', page);
    } catch (e) {
      console.error('è®°å½•ä¿å­˜å¤±è´¥:', e);
    }
  }

  // ================== è¯»å–è®¿é—®è®°å½• ==================
  function getVisitRecord() {
    // 1. ä¼˜å…ˆè¯»å–localStorage
    const localRecord = localStorage.getItem(STORAGE_KEY);
    if (localRecord && ALLOWED_PAGES.includes(localRecord)) {
      console.log('ä»localStorageè¯»å–è®°å½•:', localRecord);
      return localRecord;
    }

    // 2. è¯»å–Cookie
    const cookies = document.cookie.split(';').map(c => c.trim());
    const cookieRecord = cookies.find(c => c.startsWith(`${STORAGE_KEY}=`));
    if (cookieRecord) {
      const page = decodeURIComponent(cookieRecord.split('=')[1]);
      if (page && ALLOWED_PAGES.includes(page)) {
        console.log('ä»Cookieè¯»å–è®°å½•:', page);
        return page;
      }
    }

    // 3. æ— è®°å½•è¿”å›é»˜è®¤é¡µ
    return './page/bpuxi.html';
  }

  // ================== æ‰“å¼€é¡µé¢ï¼ˆå®æ—¶æ›´æ–°å½“å‰é¡µé¢ç¼“å­˜ï¼‰ ==================
  function openPage(path) {
    const validPage = processPath(path);
    if (!validPage) return;

    // æ›´æ–°å½“å‰æœ‰æ•ˆé¡µé¢ç¼“å­˜ï¼ˆå…³é”®ï¼‰
    currentValidPage = validPage;
    // åŠ è½½é¡µé¢å¹¶ç«‹å³å­˜å‚¨
    mainIframe.src = validPage;
    saveVisitRecord(validPage);
  }

  // ================== é¡¶éƒ¨é—®å€™åŠŸèƒ½ ==================
  function hellowl() {
    const titleText = document.getElementById('titleText');
    const hour = new Date().getHours();
    let str = 'é˜ä¸‹ï¼Œè¯·ç¨ç­‰â€¦';
    if(hour >=23 || hour <3){ str='é˜ä¸‹ï¼Œåˆå¤œäº†ï¼Œè¿˜ä¸ä¼‘æ¯å—ï¼Ÿ'; }
    else if(hour >=22){ str='é˜ä¸‹ï¼Œæ˜¯æ—¶å€™ç¡è§‰äº†å‘¢ï¼'; }
    else if(hour >=18){ str='é˜ä¸‹ï¼Œæ™šä¸Šå¥½ï¼'; }
    else if(hour >=13){ str='é˜ä¸‹ï¼Œä¸‹åˆå¥½ï¼Œæœ‰å°è¯•ç¾å‘³çš„ä¸‹åˆèŒ¶å—ï¼Ÿ'; }
    else if(hour >=12){ str='é˜ä¸‹ï¼Œåˆå¥½ï¼Œåˆé¥­é£Ÿç”¨äº†å—ï¼Ÿ'; }
    else if(hour >=8){ str='é˜ä¸‹ï¼Œä¸Šåˆå¥½ï¼'; }
    else { str='é˜ä¸‹ï¼Œæ—©ä¸Šå¥½ï¼'; }
    titleText.innerText = str;
  }

  // ================== é¡µé¢å…³é—­/åˆ·æ–°æ—¶å¼ºåˆ¶ä¿å­˜ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰ ==================
  function handleBeforeUnload() {
    // ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„å½“å‰é¡µé¢ï¼Œæ— éœ€å†å¤„ç†è·¯å¾„ï¼ˆèŠ‚çœæ—¶é—´ï¼‰
    saveVisitRecord(currentValidPage);
    // éƒ¨åˆ†æµè§ˆå™¨éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼Œä¸å½±å“å­˜å‚¨ï¼‰
    return '';
  }

  // åŒäº‹ä»¶ç›‘å¬ï¼ˆè¦†ç›–æ‰€æœ‰å…³é—­/åˆ·æ–°åœºæ™¯ï¼‰
  window.addEventListener('beforeunload', handleBeforeUnload);
  window.addEventListener('pagehide', handleBeforeUnload); // è¡¥å……ç§»åŠ¨ç«¯/ç‰¹æ®Šåœºæ™¯

  // ================== é¡µé¢åˆå§‹åŒ– ==================
  window.onload = function() {
    hellowl();
    setInterval(hellowl, 60000);

    // æ¢å¤ä¸Šæ¬¡è®¿é—®é¡µé¢
    const lastPage = getVisitRecord();
    currentValidPage = lastPage; // åˆå§‹åŒ–ç¼“å­˜
    mainIframe.src = lastPage;

    // ç›‘å¬iframeåŠ è½½æˆåŠŸï¼ˆç¡®è®¤é¡µé¢æœ‰æ•ˆï¼Œæ›´æ–°ç¼“å­˜ï¼‰
    mainIframe.onload = function() {
      const pageFromSrc = processPath(mainIframe.src.split('/').pop().replace('.html', ''));
      if (pageFromSrc) {
        currentValidPage = pageFromSrc;
        saveVisitRecord(pageFromSrc); // äºŒæ¬¡ç¡®è®¤å­˜å‚¨
      }
    };

    // ç›‘å¬iframeåŠ è½½å¤±è´¥ï¼ˆ fallback åˆ°é»˜è®¤é¡µï¼‰
    mainIframe.onerror = function() {
      console.error('iframeåŠ è½½å¤±è´¥ï¼Œåˆ‡æ¢åˆ°é»˜è®¤é¡µ');
      currentValidPage = './page/bpuxi.html';
      mainIframe.src = currentValidPage;
      saveVisitRecord(currentValidPage);
    };
  }
</script>
</body>
</html>